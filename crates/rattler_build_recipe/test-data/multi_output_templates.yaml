# Multi-output recipe with extensive Jinja template usage
schema_version: 1

context:
  name: "templated-pkg"
  version: "1.2.3"
  major_minor: "${{ version.split('.')[0] }}.{{ version.split('.')[1] }}"
  python_version: "3.11"
  staging_name: "${{ name }}-staging"

recipe:
  name: ${{ name }}
  version: ${{ version }}

outputs:
  - staging:
      name: ${{ staging_name }}
    requirements:
      build:
        - ${{ compiler('c') }}
        - if: unix
          then: make
        - if: win
          then: nmake
      host:
        - python ${{ python_version }}
    build:
      script:
        - if: unix
          then: make -j${{ CPU_COUNT }}
        - if: win
          then: nmake

  - package:
      name: ${{ name }}
      version: ${{ version }}
    inherit: ${{ staging_name }}
    requirements:
      run:
        - python ${{ python_version }}.*
        - ${{ pin_subpackage(name ~ "-lib", max_pin="x.x") }}
    about:
      summary: "Package ${{ name }} version ${{ version }}"
      license: MIT
      homepage: https://example.com/${{ name }}

  - package:
      name: ${{ name }}-lib
      version: ${{ version }}
    inherit: ${{ staging_name }}
    requirements:
      run:
        - libgcc-ng
    about:
      summary: Library for ${{ name }}
      license: MIT
