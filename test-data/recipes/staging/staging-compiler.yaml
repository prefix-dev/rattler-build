# test for issue https://github.com/prefix-dev/rattler-build/issues/1290
# Tests that file selection with glob patterns correctly handles symlinks
schema_version: 1

recipe:
  name: foo
  version: 0.1.0

outputs:
  # Staging output - builds the library files
  - staging:
      name: build-libs
    build:
      script:
        - if: unix
          then: |
            mkdir -p $PREFIX/lib
            mkdir -p $PREFIX/include
            touch $PREFIX/include/test.h
            touch $PREFIX/lib/libdav1d.so.7.0.0
            ln -s $PREFIX/lib/libdav1d.so.7.0.0 $PREFIX/lib/libdav1d.so.7
            ln -s $PREFIX/lib/libdav1d.so.7 $PREFIX/lib/libdav1d.so
        - if: win
          then: |
            mkdir %PREFIX%\lib
            mkdir %PREFIX%\include
            type nul > %PREFIX%\include\test.h
            echo. > %PREFIX%\lib\dav1d.dll
    requirements:
      build:
        - ${{ compiler('c') }}

  # Package output with file selection
  - package:
      name: testlib-so-version
      version: 2.1.4
    inherit: build-libs
    build:
      # Should select lib/libdav1d.so.7.0.0 and lib/libdav1d.so.7 but NOT lib/libdav1d.so
      files:
        include:
          - lib/*.so.*
